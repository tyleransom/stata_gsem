-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  /home/ransom/stata_gsem/gsemMonteCarloJointFactor.log
  log type:  text
 opened on:  15 Apr 2020, 15:01:58

. 
. set seed 32

. set obs 100000
number of observations (_N) was 0, now 100,000

. 
. scalar T = 10

. gen id = floor((_n-1)/`=T')+1

. bys id: gen period = _n

. xtset id period
       panel variable:  id (strongly balanced)
        time variable:  period, 1 to 10
                delta:  1 unit

. xtsum id

Variable         |      Mean   Std. Dev.       Min        Max |    Observations
-----------------+--------------------------------------------+----------------
id       overall |    5000.5   2886.766          1      10000 |     N =  100000
         between |             2886.896          1      10000 |     n =   10000
         within  |                    0     5000.5     5000.5 |     T =      10

. 
. scalar bcons  = 1.45

. scalar bmeduc = .39

. scalar bexper = .05

. scalar bexper2 = -.0001

. scalar alphaC  = .32

. scalar alphaC2 = .69

. scalar alphaW  = .45

. scalar alphaW2 = .15

. scalar vasvab1  = .45

. scalar vasvab2  = .75

. scalar vasvab3  = .33

. scalar vasvab4  = .67

. scalar vasvab5  = .91

. scalar vasvab6  = .25

. scalar vNoiseAsvab1  = .75

. scalar vNoiseAsvab2  = .85

. scalar vNoiseAsvab3  = .55

. scalar vNoiseAsvab4  = .45

. scalar vNoiseAsvab5  = .35

. scalar vNoiseAsvab6  = .95

. 
. gen meduA = rnormal(0,1)

. bys id: gen meduc = meduA[1]

. gen factA = rnormal(0,1)

. bys id: gen fact = factA[1]

. gen asvab1A = sqrt(`=vasvab1')*fact + sqrt(`=vNoiseAsvab1')*rnormal(0,1)

. bys id: gen asvab1 = asvab1A[1]

. gen asvab2A = sqrt(`=vasvab2')*fact + sqrt(`=vNoiseAsvab2')*rnormal(0,1)

. bys id: gen asvab2 = asvab2A[1]

. gen asvab3A = sqrt(`=vasvab3')*fact + sqrt(`=vNoiseAsvab3')*rnormal(0,1)

. bys id: gen asvab3 = asvab3A[1]

. gen asvab4A = sqrt(`=vasvab4')*fact + sqrt(`=vNoiseAsvab4')*rnormal(0,1)

. bys id: gen asvab4 = asvab4A[1]

. gen asvab5A = sqrt(`=vasvab5')*fact + sqrt(`=vNoiseAsvab5')*rnormal(0,1)

. bys id: gen asvab5 = asvab5A[1]

. gen asvab6A = sqrt(`=vasvab6')*fact + sqrt(`=vNoiseAsvab6')*rnormal(0,1)

. bys id: gen asvab6 = asvab6A[1]

. gen fact2A = rnormal(0,1)

. bys id: gen fact2 = fact2A[1]

. drop factA fact2A meduA asvab?A

. 
. gen double draw = runiform()

. gen double noise = rnormal(0,.35)

. gen double exper = rnormal(5,10)

. replace exper = 0 if exper<=0
(30,939 real changes made)

. 
. l id period exper fact draw asvab? in 1/20, sepby(id)

     +------------------------------------------------------------------------+
  1. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      1 |         0 | -1.033358 | .67332727 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  2. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      2 | 11.099354 | -1.033358 | .97348945 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  3. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      3 |         0 | -1.033358 | .49079623 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  4. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      4 |         0 | -1.033358 | .43174401 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  5. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      5 | 23.989806 | -1.033358 | .68965379 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  6. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      6 |         0 | -1.033358 |  .0161271 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  7. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      7 | 29.248642 | -1.033358 | .53034588 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  8. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      8 | 24.158133 | -1.033358 | .59628925 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
  9. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |      9 | 7.8227708 | -1.033358 | .21568155 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 10. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  1 |     10 | 5.9329524 | -1.033358 | .14620535 |  -.13268 | -.9945105 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |      -1.2476    |    -.1631744    |    -1.150251    |     .6694896     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 11. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      1 |   1.98698 | -1.148197 |  .7695822 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 12. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      2 | 20.413773 | -1.148197 | .57167167 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 13. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      3 | 4.5270863 | -1.148197 |  .2340516 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 14. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      4 |         0 | -1.148197 | .55599324 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 15. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      5 |         0 | -1.148197 | .33004454 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 16. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      6 | 17.586833 | -1.148197 | .16177153 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 17. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      7 | 7.2428335 | -1.148197 | .99749397 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 18. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      8 |         0 | -1.148197 | .23996549 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 19. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |      9 | 11.188093 | -1.148197 |  .7468379 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

     +------------------------------------------------------------------------+
 20. | id | period |     exper |      fact |      draw |   asvab1 |    asvab2 |
     |  2 |     10 |         0 | -1.148197 | .52051121 | -.978944 |   -.95979 |
     |------------------------------------------------------------------------|
     |       asvab3    |       asvab4    |       asvab5    |       asvab6     |
     |    -1.091419    |    -1.212103    |    -1.465388    |    -1.859934     |
     +------------------------------------------------------------------------+

. 
. gen p1 = exp(`=bcons' + `=bmeduc'*meduc + `=bexper'*exper + `=bexper2'*exper^
> 2 + `=alphaC'*fact )/(1+exp(`=bcons' + `=bmeduc'*meduc + `=bexper'*exper + `=
> bexper2'*exper^2 + `=alphaC'*fact))

. gen p2 = exp(`=bcons' + `=bmeduc'*meduc + `=bexper'*exper + `=bexper2'*exper^
> 2 + `=alphaC'*fact + `=alphaC2'*fact2)/(1+exp(`=bcons' + `=bmeduc'*meduc + `=
> bexper'*exper + `=bexper2'*exper^2 + `=alphaC'*fact + `=alphaC2'*fact2))

. gen work = p1>draw

. gen work2= p2>draw

. 
. gen lnWage = `=bcons' + `=bexper'*exper + `=bexper2'*exper^2 + `=alphaW'*fact
>                     + noise if work
(15,794 missing values generated)

. gen lnWage2= `=bcons' + `=bexper'*exper + `=bexper2'*exper^2 + `=alphaW'*fact
>  + `=alphaW2'*fact2 + noise if work2
(17,428 missing values generated)

. 
. * infeasible
. reg lnWage c.exper##c.exper fact if work

      Source |       SS           df       MS      Number of obs   =    84,206
-------------+----------------------------------   F(3, 84202)     =  73371.28
       Model |  27177.7966         3  9059.26554   Prob > F        =    0.0000
    Residual |  10396.5512    84,202  .123471548   R-squared       =    0.7233
-------------+----------------------------------   Adj R-squared   =    0.7233
       Total |  37574.3479    84,205  .446224664   Root MSE        =    .35139

------------------------------------------------------------------------------
      lnWage |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       exper |   .0499916   .0004213   118.66   0.000     .0491659    .0508174
             |
     c.exper#|
     c.exper |  -.0001122   .0000178    -6.30   0.000    -.0001471   -.0000773
             |
        fact |   .4492365   .0012252   366.66   0.000     .4468351    .4516379
       _cons |   1.450792   .0018994   763.82   0.000      1.44707    1.454515
------------------------------------------------------------------------------

. reg lnWage2 c.exper##c.exper fact fact2 if work2

      Source |       SS           df       MS      Number of obs   =    82,572
-------------+----------------------------------   F(4, 82567)     =  56692.77
       Model |  27995.9226         4  6998.98065   Prob > F        =    0.0000
    Residual |  10193.2722    82,567  .123454555   R-squared       =    0.7331
-------------+----------------------------------   Adj R-squared   =    0.7331
       Total |  38189.1948    82,571    .4625013   Root MSE        =    .35136

------------------------------------------------------------------------------
     lnWage2 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       exper |   .0498868   .0004249   117.40   0.000      .049054    .0507197
             |
     c.exper#|
     c.exper |  -.0001109   .0000179    -6.18   0.000     -.000146   -.0000757
             |
        fact |   .4490582    .001239   362.44   0.000     .4466298    .4514866
       fact2 |   .1504825   .0012547   119.93   0.000     .1480232    .1529417
       _cons |   1.451058   .0019279   752.66   0.000     1.447279    1.454836
------------------------------------------------------------------------------

. logit work  meduc c.exper##c.exper fact

Iteration 0:   log likelihood = -43623.809  
Iteration 1:   log likelihood = -41489.554  
Iteration 2:   log likelihood = -41401.415  
Iteration 3:   log likelihood = -41400.953  
Iteration 4:   log likelihood = -41400.953  

Logistic regression                             Number of obs     =    100,000
                                                LR chi2(4)        =    4445.71
                                                Prob > chi2       =     0.0000
Log likelihood = -41400.953                     Pseudo R2         =     0.0510

------------------------------------------------------------------------------
        work |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       meduc |   .3932254   .0090803    43.31   0.000     .3754284    .4110225
       exper |   .0500226   .0034497    14.50   0.000     .0432614    .0567839
             |
     c.exper#|
     c.exper |  -.0001675   .0001656    -1.01   0.312    -.0004921     .000157
             |
        fact |   .3126259   .0090158    34.68   0.000     .2949552    .3302965
       _cons |   1.462493   .0129327   113.09   0.000     1.437146    1.487841
------------------------------------------------------------------------------

. logit work2 meduc c.exper##c.exper fact fact2

Iteration 0:   log likelihood = -46260.821  
Iteration 1:   log likelihood = -41513.841  
Iteration 2:   log likelihood = -41182.209  
Iteration 3:   log likelihood = -41181.403  
Iteration 4:   log likelihood = -41181.403  

Logistic regression                             Number of obs     =    100,000
                                                LR chi2(5)        =   10158.84
                                                Prob > chi2       =     0.0000
Log likelihood = -41181.403                     Pseudo R2         =     0.1098

------------------------------------------------------------------------------
       work2 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       meduc |   .3983184   .0090791    43.87   0.000     .3805238     .416113
       exper |   .0499204   .0033897    14.73   0.000     .0432767     .056564
             |
     c.exper#|
     c.exper |  -.0001119   .0001611    -0.69   0.487    -.0004277    .0002038
             |
        fact |   .3205947   .0089534    35.81   0.000     .3030463    .3381431
       fact2 |    .687748   .0094743    72.59   0.000     .6691786    .7063173
       _cons |   1.464224   .0132702   110.34   0.000     1.438215    1.490233
------------------------------------------------------------------------------

. 
. * wage RE by itself
. xtreg lnWage c.exper##c.exper, re

Random-effects GLS regression                   Number of obs     =     84,206
Group variable: id                              Number of groups  =     10,000

R-sq:                                           Obs per group:
     within  = 0.5116                                         min =          2
     between = 0.0524                                         avg =        8.4
     overall = 0.2815                                         max =         10

                                                Wald chi2(2)      =   78281.90
corr(u_i, X)   = 0 (assumed)                    Prob > chi2       =     0.0000

------------------------------------------------------------------------------
      lnWage |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       exper |   .0500095   .0004473   111.81   0.000     .0491329    .0508862
             |
     c.exper#|
     c.exper |  -.0001154   .0000189    -6.10   0.000    -.0001524   -.0000783
             |
       _cons |    1.45392   .0048847   297.65   0.000     1.444346    1.463494
-------------+----------------------------------------------------------------
     sigma_u |  .44651152
     sigma_e |  .35173866
         rho |  .61707549   (fraction of variance due to u_i)
------------------------------------------------------------------------------

. gsem (lnWage <- c.exper##c.exper Factor[id]), var(Factor[id]@1)

Fitting fixed-effects model:

Iteration 0:   log likelihood =  -71587.96  
Iteration 1:   log likelihood =  -71587.96  

Refining starting values:

Grid node 0:   log likelihood = -61304.101

Fitting full model:

Iteration 0:   log likelihood = -61304.101  (not concave)
Iteration 1:   log likelihood = -51122.719  
Iteration 2:   log likelihood = -45867.322  
Iteration 3:   log likelihood = -45266.825  
Iteration 4:   log likelihood = -44835.782  
Iteration 5:   log likelihood = -44831.804  
Iteration 6:   log likelihood = -44831.801  

Generalized structural equation model           Number of obs     =     84,206
Response       : lnWage
Family         : Gaussian
Link           : identity
Log likelihood = -44831.801

 ( 1)  [var(Factor[id])]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
lnWage <-    |
       exper |   .0500095   .0004473   111.80   0.000     .0491327    .0508862
             |
     c.exper#|
     c.exper |  -.0001154   .0000189    -6.10   0.000    -.0001524   -.0000783
             |
  Factor[id] |   .4461566   .0033993   131.25   0.000     .4394941    .4528191
             |
       _cons |   1.453923   .0048817   297.83   0.000     1.444355    1.463491
-------------+----------------------------------------------------------------
        var( |
  Factor[id])|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.lnWage)|   .1237381   .0006425                      .1224853    .1250038
------------------------------------------------------------------------------

. 
. * logit RE by itself
. xtlogit work meduc c.exper##c.exper, re

Fitting comparison model:

Iteration 0:   log likelihood = -43623.809  
Iteration 1:   log likelihood = -42065.763  
Iteration 2:   log likelihood = -42014.036  
Iteration 3:   log likelihood = -42013.748  
Iteration 4:   log likelihood = -42013.748  

Fitting full model:

tau =  0.0     log likelihood = -42013.748
tau =  0.1     log likelihood = -41980.929
tau =  0.2     log likelihood = -42049.014

Iteration 0:   log likelihood = -41980.929  
Iteration 1:   log likelihood = -41973.606  
Iteration 2:   log likelihood = -41973.605  

Random-effects logistic regression              Number of obs     =    100,000
Group variable: id                              Number of groups  =     10,000

Random effects u_i ~ Gaussian                   Obs per group:
                                                              min =         10
                                                              avg =       10.0
                                                              max =         10

Integration method: mvaghermite                 Integration pts.  =         12

                                                Wald chi2(3)      =    2751.38
Log likelihood  = -41973.605                    Prob > chi2       =     0.0000

------------------------------------------------------------------------------
        work |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       meduc |   .3986714   .0097731    40.79   0.000     .3795164    .4178264
       exper |   .0504079   .0034748    14.51   0.000     .0435974    .0572184
             |
     c.exper#|
     c.exper |  -.0001838   .0001666    -1.10   0.270    -.0005103    .0001428
             |
       _cons |   1.465834   .0138388   105.92   0.000     1.438711    1.492958
-------------+----------------------------------------------------------------
    /lnsig2u |   -2.23779    .123594                      -2.48003    -1.99555
-------------+----------------------------------------------------------------
     sigma_u |   .3266406   .0201854                      .2893799    .3686989
         rho |   .0314124   .0037604                      .0248223    .0396808
------------------------------------------------------------------------------
LR test of rho=0: chibar2(01) = 80.29                  Prob >= chibar2 = 0.000

. gsem (i.work <- meduc c.exper##c.exper Factor[id], mlogit), var(Factor[id]@1)

Fitting fixed-effects model:

Iteration 0:   log likelihood = -43623.809  
Iteration 1:   log likelihood = -42065.763  
Iteration 2:   log likelihood = -42014.036  
Iteration 3:   log likelihood = -42013.748  
Iteration 4:   log likelihood = -42013.748  

Refining starting values:

Grid node 0:   log likelihood = -42891.349

Fitting full model:

Iteration 0:   log likelihood = -42891.349  
Iteration 1:   log likelihood = -42072.309  
Iteration 2:   log likelihood = -41978.268  
Iteration 3:   log likelihood = -41973.609  
Iteration 4:   log likelihood = -41973.605  

Generalized structural equation model           Number of obs     =    100,000
Response       : work
Base outcome   : 0
Family         : multinomial
Link           : logit
Log likelihood = -41973.605

 ( 1)  [var(Factor[id])]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
0.work       |  (base outcome)
-------------+----------------------------------------------------------------
1.work <-    |
       meduc |   .3986718   .0097732    40.79   0.000     .3795167    .4178268
       exper |   .0504079   .0034748    14.51   0.000     .0435974    .0572184
             |
     c.exper#|
     c.exper |  -.0001838   .0001666    -1.10   0.270    -.0005103    .0001428
             |
  Factor[id] |  -.3266466   .0201852   -16.18   0.000     -.366209   -.2870843
             |
       _cons |   1.465835   .0138389   105.92   0.000     1.438711    1.492958
-------------+----------------------------------------------------------------
        var( |
  Factor[id])|          1  (constrained)
------------------------------------------------------------------------------

. 
. * joint estimation
. gsem (i.work <- meduc c.exper##c.exper Factor[id], mlogit) (lnWage <- c.exper
> ##c.exper Factor[id]), var(Factor[id]@1)

Fitting fixed-effects model:

Iteration 0:   log likelihood = -115211.77  
Iteration 1:   log likelihood = -113653.72  
Iteration 2:   log likelihood =    -113602  
Iteration 3:   log likelihood = -113601.71  
Iteration 4:   log likelihood = -113601.71  

Refining starting values:

Grid node 0:   log likelihood = -113669.27

Fitting full model:

Iteration 0:   log likelihood = -113669.27  (not concave)
Iteration 1:   log likelihood = -97148.807  (not concave)
Iteration 2:   log likelihood = -89423.339  
Iteration 3:   log likelihood = -87305.225  
Iteration 4:   log likelihood = -86304.993  
Iteration 5:   log likelihood = -86296.051  
Iteration 6:   log likelihood = -86296.045  

Generalized structural equation model           Number of obs     =    100,000

Response       : work                           Number of obs     =    100,000
Base outcome   : 0
Family         : multinomial
Link           : logit

Response       : lnWage                         Number of obs     =     84,206
Family         : Gaussian
Link           : identity

Log likelihood = -86296.045

 ( 1)  [var(Factor[id])]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
0.work       |  (base outcome)
-------------+----------------------------------------------------------------
1.work <-    |
       meduc |   .3938674   .0091296    43.14   0.000     .3759737     .411761
       exper |   .0501329   .0034509    14.53   0.000     .0433692    .0568965
             |
     c.exper#|
     c.exper |  -.0001729   .0001656    -1.04   0.296    -.0004976    .0001517
             |
  Factor[id] |   .3071688   .0096075    31.97   0.000     .2883385    .3259992
             |
       _cons |   1.462179   .0133022   109.92   0.000     1.436107    1.488251
-------------+----------------------------------------------------------------
lnWage <-    |
       exper |   .0500981   .0004471   112.06   0.000     .0492219    .0509744
             |
     c.exper#|
     c.exper |  -.0001169   .0000189    -6.18   0.000     -.000154   -.0000799
             |
  Factor[id] |    .446664   .0034029   131.26   0.000     .4399945    .4533335
             |
       _cons |   1.451659   .0048863   297.09   0.000     1.442082    1.461236
-------------+----------------------------------------------------------------
        var( |
  Factor[id])|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.lnWage)|   .1237247   .0006423                      .1224721    .1249901
------------------------------------------------------------------------------

. 
. forv x=1/6 {
  2.     bys id: replace asvab`x' = . if _n>1
  3. }
(90,000 real changes made, 90,000 to missing)
(90,000 real changes made, 90,000 to missing)
(90,000 real changes made, 90,000 to missing)
(90,000 real changes made, 90,000 to missing)
(90,000 real changes made, 90,000 to missing)
(90,000 real changes made, 90,000 to missing)

. 
. * simple estimation of wage only
. gsem (lnWage <- c.exper##c.exper), nocapslatent difficult dnumerical nonrtole
> rance

Iteration 0:   log likelihood =  -71587.96  
Iteration 1:   log likelihood =  -71587.96  

Generalized structural equation model           Number of obs     =     84,206
Response       : lnWage
Family         : Gaussian
Link           : identity
Log likelihood =  -71587.96

------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
lnWage <-    |
       exper |   .0494043   .0006789    72.77   0.000     .0480737    .0507348
             |
     c.exper#|
     c.exper |  -.0001191   .0000287    -4.15   0.000    -.0001754   -.0000629
             |
       _cons |   1.478047   .0030583   483.30   0.000     1.472053    1.484041
-------------+----------------------------------------------------------------
var(e.lnWage)|   .3205966   .0015624                      .3175489    .3236736
------------------------------------------------------------------------------

. matrix bwage0 = e(b)

. 
. * joint estimation of measurement system with wage only
. gsem (Ability -> asvab1-asvab6) (lnWage <- c.exper##c.exper Ability), latent(
> Ability) var(Ability@1) nocapslatent difficult dnumerical nonrtolerance

Fitting fixed-effects model:

Iteration 0:   log likelihood = -161956.09  
Iteration 1:   log likelihood = -161956.09  

Refining starting values:

Grid node 0:   log likelihood = -155536.23

Fitting full model:

Iteration 0:   log likelihood = -155536.23  
Iteration 1:   log likelihood = -150719.42  
Iteration 2:   log likelihood = -149119.11  
Iteration 3:   log likelihood = -149073.35  
Iteration 4:   log likelihood =    -149073  
Iteration 5:   log likelihood =    -149073  

Generalized structural equation model           Number of obs     =     85,821

Response       : asvab1                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab2                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab3                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab4                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab5                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab6                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : lnWage                         Number of obs     =     84,206
Family         : Gaussian
Link           : identity

Log likelihood =    -149073

 ( 1)  [var(Ability)]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
asvab1 <-    |
     Ability |   .6672724   .0099837    66.84   0.000     .6477048      .68684
       _cons |   .0070033   .0097481     0.72   0.472    -.0121026    .0261093
-------------+----------------------------------------------------------------
asvab2 <-    |
     Ability |   .8534517   .0113281    75.34   0.000     .8312489    .8756544
       _cons |   .0100355   .0111637     0.90   0.369     -.011845     .031916
-------------+----------------------------------------------------------------
asvab3 <-    |
     Ability |   .5704755   .0086294    66.11   0.000     .5535621    .5873888
       _cons |   .0204732   .0084186     2.43   0.015     .0039731    .0369734
-------------+----------------------------------------------------------------
asvab4 <-    |
     Ability |   .8206084    .008849    92.74   0.000     .8032647     .837952
       _cons |    .025738   .0088985     2.89   0.004     .0082972    .0431788
-------------+----------------------------------------------------------------
asvab5 <-    |
     Ability |   .9528099   .0088162   108.08   0.000     .9355306    .9700893
       _cons |   .0145341   .0090216     1.61   0.107    -.0031479    .0322161
-------------+----------------------------------------------------------------
asvab6 <-    |
     Ability |   .4947543   .0108438    45.63   0.000     .4735008    .5160078
       _cons |   .0095682   .0103818     0.92   0.357    -.0107797    .0299161
-------------+----------------------------------------------------------------
lnWage <-    |
       exper |   .0496015    .000644    77.02   0.000     .0483393    .0508637
             |
     c.exper#|
     c.exper |  -.0001278   .0000272    -4.69   0.000    -.0001812   -.0000744
             |
     Ability |     .44494   .0029775   149.44   0.000     .4391043    .4507758
       _cons |    1.47521   .0029601   498.36   0.000     1.469409    1.481012
-------------+----------------------------------------------------------------
 var(Ability)|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.asvab1)|   .7289608   .0112283                      .7072827    .7513034
var(e.asvab2)|   .8844721   .0140673                       .857326    .9124777
var(e.asvab3)|   .5469576   .0084059                       .530728    .5636835
var(e.asvab4)|   .4575457   .0081099                      .4419236    .4737201
var(e.asvab5)|   .3633839   .0077903                      .3484314     .378978
var(e.asvab6)|   .9557759   .0139933                      .9287393    .9835995
var(e.lnWage)|   .1228668   .0023051                       .118431    .1274687
------------------------------------------------------------------------------

. matrix bwage = e(b)

. 
. * joint estimation of measurement system with labor supply only
. gsem (Ability -> asvab1-asvab6) (i.work <- meduc c.exper##c.exper Ability, ml
> ogit), latent(Ability) var(Ability@1) nocapslatent difficult dnumerical nonrt
> olerance

Fitting fixed-effects model:

Iteration 0:   log likelihood = -133991.93  
Iteration 1:   log likelihood = -132433.89  
Iteration 2:   log likelihood = -132382.16  
Iteration 3:   log likelihood = -132381.87  
Iteration 4:   log likelihood = -132381.87  

Refining starting values:

Grid node 0:   log likelihood = -131252.78

Fitting full model:

Iteration 0:   log likelihood = -131252.78  (not concave)
Iteration 1:   log likelihood =  -124637.2  
Iteration 2:   log likelihood = -122885.66  
Iteration 3:   log likelihood = -122586.81  
Iteration 4:   log likelihood = -122575.46  
Iteration 5:   log likelihood =  -122575.4  
Iteration 6:   log likelihood =  -122575.4  

Generalized structural equation model           Number of obs     =    100,000

Response       : asvab1                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab2                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab3                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab4                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab5                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab6                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : work                           Number of obs     =    100,000
Base outcome   : 0
Family         : multinomial
Link           : logit

Log likelihood =  -122575.4

 ( 1)  [var(Ability)]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
asvab1 <-    |
     Ability |   .6682202   .0104431    63.99   0.000     .6477521    .6886882
       _cons |  -.0079396   .0108042    -0.73   0.462    -.0291155    .0132363
-------------+----------------------------------------------------------------
asvab2 <-    |
     Ability |   .8531487   .0119576    71.35   0.000     .8297122    .8765851
       _cons |  -.0090785   .0126555    -0.72   0.473    -.0338828    .0157257
-------------+----------------------------------------------------------------
asvab3 <-    |
     Ability |   .5723533   .0090164    63.48   0.000     .5546816    .5900251
       _cons |   .0076993   .0093131     0.83   0.408    -.0105541    .0259526
-------------+----------------------------------------------------------------
asvab4 <-    |
     Ability |   .8200963    .009574    85.66   0.000     .8013315     .838861
       _cons |   .0073592   .0105856     0.70   0.487    -.0133882    .0281067
-------------+----------------------------------------------------------------
asvab5 <-    |
     Ability |   .9509349   .0097931    97.10   0.000     .9317407    .9701291
       _cons |   -.006807   .0112128    -0.61   0.544    -.0287836    .0151696
-------------+----------------------------------------------------------------
asvab6 <-    |
     Ability |   .4938342   .0111471    44.30   0.000     .4719863    .5156822
       _cons |  -.0015133   .0109398    -0.14   0.890    -.0229549    .0199283
-------------+----------------------------------------------------------------
0.work       |  (base outcome)
-------------+----------------------------------------------------------------
1.work <-    |
       meduc |   .3994088    .009272    43.08   0.000     .3812359    .4175817
       exper |   .0504566   .0034878    14.47   0.000     .0436206    .0572926
             |
     c.exper#|
     c.exper |  -.0001831    .000167    -1.10   0.273    -.0005104    .0001442
             |
     Ability |   .3635228   .0307772    11.81   0.000     .3032007     .423845
       _cons |   1.473783   .0145208   101.49   0.000     1.445322    1.502243
-------------+----------------------------------------------------------------
 var(Ability)|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.asvab1)|    .727349     .01144                       .705269    .7501202
var(e.asvab2)|   .8844252   .0144718                      .8565109    .9132492
var(e.asvab3)|   .5445579    .008547                      .5280611    .5615701
var(e.asvab4)|   .4578651   .0086594                      .4412037    .4751558
var(e.asvab5)|    .366252   .0088249                      .3493576    .3839634
var(e.asvab6)|   .9564954   .0141076                      .9292408    .9845493
------------------------------------------------------------------------------

. matrix bchoice = e(b)

. 
. * joint estimation with measurement system with everything
. matrix temp = bwage0,bchoice

. gsem (Ability -> asvab1-asvab6) (i.work <- meduc c.exper##c.exper Ability, ml
> ogit) (lnWage <- c.exper##c.exper Ability), latent(Ability) var(Ability@1) no
> capslatent difficult from(temp,skip)

Fitting fixed-effects model:

Iteration 0:   log likelihood = -204326.55  
Iteration 1:   log likelihood = -203973.01  
Iteration 2:   log likelihood = -203969.83  
Iteration 3:   log likelihood = -203969.83  

Refining starting values:

Grid node 0:   log likelihood = -223689.25

Fitting full model:

Iteration 0:   log likelihood = -223689.25  (not concave)
Iteration 1:   log likelihood = -193184.74  (not concave)
Iteration 2:   log likelihood = -191691.96  
Iteration 3:   log likelihood = -191126.13  
Iteration 4:   log likelihood = -191015.43  
Iteration 5:   log likelihood =  -191014.7  
Iteration 6:   log likelihood =  -191014.7  

Generalized structural equation model           Number of obs     =    100,000

Response       : asvab1                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab2                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab3                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab4                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab5                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab6                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : work                           Number of obs     =    100,000
Base outcome   : 0
Family         : multinomial
Link           : logit

Response       : lnWage                         Number of obs     =     84,206
Family         : Gaussian
Link           : identity

Log likelihood =  -191014.7

 ( 1)  [var(Ability)]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
asvab1 <-    |
     Ability |   .6674992   .0099916    66.81   0.000      .647916    .6870823
       _cons |  -.0068897   .0098029    -0.70   0.482     -.026103    .0123235
-------------+----------------------------------------------------------------
asvab2 <-    |
     Ability |   .8537108   .0113388    75.29   0.000     .8314873    .8759344
       _cons |   -.007734   .0112429    -0.69   0.492    -.0297696    .0143016
-------------+----------------------------------------------------------------
asvab3 <-    |
     Ability |   .5709034   .0086351    66.11   0.000     .5539789    .5878279
       _cons |   .0085962   .0084641     1.02   0.310     -.007993    .0251854
-------------+----------------------------------------------------------------
asvab4 <-    |
     Ability |   .8210552   .0088587    92.68   0.000     .8036923     .838418
       _cons |   .0086528   .0089905     0.96   0.336    -.0089682    .0262738
-------------+----------------------------------------------------------------
asvab5 <-    |
     Ability |     .95326   .0088283   107.98   0.000     .9359568    .9705632
       _cons |  -.0053037   .0091449    -0.58   0.562    -.0232274      .01262
-------------+----------------------------------------------------------------
asvab6 <-    |
     Ability |   .4954575   .0108482    45.67   0.000     .4741955    .5167195
       _cons |  -.0007315   .0104071    -0.07   0.944    -.0211289     .019666
-------------+----------------------------------------------------------------
0.work       |  (base outcome)
-------------+----------------------------------------------------------------
1.work <-    |
       meduc |    .395679   .0091446    43.27   0.000     .3777559    .4136021
       exper |   .0503562   .0034719    14.50   0.000     .0435515    .0571609
             |
     c.exper#|
     c.exper |  -.0001872   .0001664    -1.13   0.260    -.0005133    .0001388
             |
     Ability |   .3268273   .0276583    11.82   0.000     .2726179    .3810366
       _cons |   1.466293   .0139831   104.86   0.000     1.438887    1.493699
-------------+----------------------------------------------------------------
lnWage <-    |
       exper |   .0504495   .0006494    77.68   0.000     .0491767    .0517224
             |
     c.exper#|
     c.exper |  -.0001388   .0000273    -5.08   0.000    -.0001924   -.0000852
             |
     Ability |   .4472615   .0030288   147.67   0.000     .4413251    .4531978
       _cons |   1.450296   .0036174   400.92   0.000     1.443206    1.457386
-------------+----------------------------------------------------------------
 var(Ability)|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.asvab1)|   .7290838   .0112266                      .7074088    .7514229
var(e.asvab2)|   .8847279   .0140647                      .8575866    .9127281
var(e.asvab3)|   .5467805   .0084016                      .5305591    .5634978
var(e.asvab4)|   .4574592   .0081023                      .4418515    .4736183
var(e.asvab5)|   .3633979   .0077785                      .3484676    .3789679
var(e.asvab6)|   .9553138   .0139863                      .9282908    .9831236
var(e.lnWage)|   .1231377    .002314                      .1186848    .1277577
------------------------------------------------------------------------------

. matrix fac1 = e(b)

. 
. * joint estimation with 2 factors (different DGP, so different dependent vari
> ables)
. gsem (Ability -> asvab1-asvab6) (1.work2 <- meduc c.exper##c.exper Ability No
> ncog[id], mlogit) (lnWage2 <- c.exper##c.exper Ability Noncog[id]), var(Abili
> ty@1 Noncog[id]@1) cov(Ability*Noncog[id]@0) latent(Ability Noncog) nocapslat
> ent difficult dnumerical nonrtolerance from(fac1,skip)

Fitting fixed-effects model:

Iteration 0:   log likelihood = -209159.42  
Iteration 1:   log likelihood = -207689.83  
Iteration 2:   log likelihood = -207648.96  
Iteration 3:   log likelihood = -207648.75  
Iteration 4:   log likelihood = -207648.75  

Refining starting values:

Grid node 0:   log likelihood = -215410.85

Fitting full model:

Iteration 0:   log likelihood = -215410.85  (not concave)
Iteration 1:   log likelihood = -192124.92  (not concave)
Iteration 2:   log likelihood = -177564.92  (not concave)
Iteration 3:   log likelihood = -170261.74  (not concave)
Iteration 4:   log likelihood = -168701.63  
Iteration 5:   log likelihood =  -168328.5  
Iteration 6:   log likelihood = -168309.93  
Iteration 7:   log likelihood = -168309.61  
Iteration 8:   log likelihood = -168309.61  

Generalized structural equation model           Number of obs     =    100,000

Response       : asvab1                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab2                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab3                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab4                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab5                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : asvab6                         Number of obs     =     10,000
Family         : Gaussian
Link           : identity

Response       : work2                          Number of obs     =    100,000
Base outcome   : 0
Family         : multinomial
Link           : logit

Response       : lnWage2                        Number of obs     =     82,572
Family         : Gaussian
Link           : identity

Log likelihood = -168309.61

 ( 1)  [var(Noncog[id])]_cons = 1
 ( 2)  [var(Ability)]_cons = 1
------------------------------------------------------------------------------
             |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
asvab1 <-    |
     Ability |   .6686839   .0104465    64.01   0.000     .6482092    .6891587
       _cons |  -.0077939    .010815    -0.72   0.471    -.0289909    .0134032
-------------+----------------------------------------------------------------
asvab2 <-    |
     Ability |   .8535533   .0119622    71.35   0.000     .8301078    .8769988
       _cons |  -.0088928   .0126705    -0.70   0.483    -.0337264    .0159409
-------------+----------------------------------------------------------------
asvab3 <-    |
     Ability |   .5721263   .0090211    63.42   0.000     .5544453    .5898072
       _cons |   .0078232   .0093223     0.84   0.401    -.0104482    .0260946
-------------+----------------------------------------------------------------
asvab4 <-    |
     Ability |   .8203357   .0095792    85.64   0.000     .8015608    .8391106
       _cons |   .0075376   .0106022     0.71   0.477    -.0132423    .0283175
-------------+----------------------------------------------------------------
asvab5 <-    |
     Ability |   .9511611   .0097995    97.06   0.000     .9319544    .9703677
       _cons |  -.0066003   .0112338    -0.59   0.557    -.0286181    .0154176
-------------+----------------------------------------------------------------
asvab6 <-    |
     Ability |   .4935281   .0111519    44.26   0.000     .4716709    .5153854
       _cons |  -.0014065   .0109456    -0.13   0.898    -.0228595    .0200465
-------------+----------------------------------------------------------------
0.work2      |  (base outcome)
-------------+----------------------------------------------------------------
1.work2 <-   |
       meduc |   .3677434   .0090307    40.72   0.000     .3500435    .3854433
       exper |   .0482773   .0033457    14.43   0.000     .0417199    .0548348
             |
     c.exper#|
     c.exper |  -.0001067   .0001593    -0.67   0.503    -.0004189    .0002055
             |
  Noncog[id] |  -.5392114   .0108023   -49.92   0.000    -.5603835   -.5180394
             |
     Ability |  -.1251882   .0307183    -4.08   0.000     -.185395   -.0649815
       _cons |   1.396322      .0141    99.03   0.000     1.368687    1.423958
-------------+----------------------------------------------------------------
lnWage2 <-   |
       exper |   .0499938   .0004518   110.66   0.000     .0491083    .0508792
             |
     c.exper#|
     c.exper |  -.0001142   .0000191    -5.99   0.000    -.0001516   -.0000768
             |
  Noncog[id] |  -.4698361   .0036007  -130.48   0.000    -.4768933   -.4627788
             |
     Ability |   .0389113   .0044981     8.65   0.000     .0300952    .0477274
       _cons |   1.451268   .0051192   283.49   0.000     1.441234    1.461301
-------------+----------------------------------------------------------------
        var( |
  Noncog[id])|          1  (constrained)
 var(Ability)|          1  (constrained)
-------------+----------------------------------------------------------------
var(e.asvab1)|   .7269282   .0114371                       .704854    .7496936
var(e.asvab2)|   .8840588   .0144706                       .856147    .9128806
var(e.asvab3)|   .5449639    .008552                      .5284575    .5619859
var(e.asvab4)|   .4577721   .0086625                      .4411049     .475069
var(e.asvab5)|   .3662244   .0088315                      .3493176    .3839494
var(e.asvab6)|   .9569061   .0141128                      .9296415    .9849702
var(e.lnWa~2)|   .1226251   .0007138                      .1212341    .1240322
------------------------------------------------------------------------------

. 
. log close
      name:  <unnamed>
       log:  /home/ransom/stata_gsem/gsemMonteCarloJointFactor.log
  log type:  text
 closed on:  15 Apr 2020, 19:01:05
-------------------------------------------------------------------------------
